---
title: "overview_0601"
output: html_document
---

```{r}
knitr::opts_chunk$set(message = F,
                      warning = F,
                      echo = T,
                      results = T)
```


```{r}
tar_load(artists)
mbz_deezer <- load_s3("interim/musicbrainz_urls_collapsed.csv")
contacts <- load_s3("senscritique/contacts.csv")

# musicbrainz keys
mbz_deezer <- tibble(mbz_deezer) %>% 
  filter(!is.na(deezer)) %>% 
  rename(musicBrainzID = "musicbrainz_id",
         deezerID = "deezer") # %>% 
  #select(musicBrainzID, deezerID) 

# contacts keys
contacts <- contacts %>% 
  as_tibble() %>% 
  select(contact_id, contact_name, mbz_id, spotify_id)
```




## raw data: how many unique artists in deezer, how many pairs in mbz and contacts

```{r}
head(artists)
nrow(artists)
sum(artists$f_n_play)
```

```{r}
head(mbz_deezer)
nrow(mbz_deezer)
```

```{r}
head(contacts)
nrow(contacts)
```


## how many joins in mbz only, contacts only, and across both
```{r}
all <- artists %>% 
  full_join(mbz_deezer, by = c(deezer_id = "deezerID")) %>% 
  full_join(contacts, by = c(musicBrainzID = "mbz_id"))

head(all)
```


# wiki_ids

##### show in how many cases alternative sources are useful

```{r}
wiki <- load_s3("interim/wiki_ids.csv") %>% 
  as_tibble()

head(wiki)
```


```{r}
# no cases of valid spotify_id when deezer is missing in mbz and/or contacts
wiki %>% 
  filter(is.na(musicBrainzID) &
           !is.na(deezerID) &
           !is.na(itemId))
```


need to check if i can add contacts-mbz matches through intermediate sources in mbz_deezer and contacts

filter cases where i don't have mbz, then try to join through an intermediate id to see how many cases this yields


```{r}
miss <- all %>% 
  filter(is.na(musicBrainzID))

test <- miss %>% 
  left_join(wiki, by = c(deezer_id = "deezerID"))

```





```{r}
t <- mbz_deezer %>% 
  filter(is.na(deezerID))


```










